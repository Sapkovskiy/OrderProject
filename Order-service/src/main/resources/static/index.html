<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞–º–∏</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <script defer src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <style>
        .modal-dialog {
            max-height: 90vh;
            overflow-y: auto;
        }
        .modal-content {
            max-height: 90vh;
            overflow-y: auto;
        }
    </style>
</head>
<body class="container mt-4">
<h2 class="mb-3">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞–º–∏</h2>

<div class="mb-3">
    <button class="btn btn-primary" onclick="getAllOrders()">üì¶ –í—Å–µ –∑–∞–∫–∞–∑—ã</button>
    <button class="btn btn-success" data-bs-toggle="modal" data-bs-target="#createOrderModal">‚ûï –°–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑</button>
</div>

<div class="mb-3">
    <input type="number" id="orderId" class="form-control d-inline w-auto" placeholder="ID –∑–∞–∫–∞–∑–∞">
    <button class="btn btn-secondary" onclick="getOrderById()">üîé –ü–æ–∏—Å–∫ –∑–∞–∫–∞–∑–∞</button>
</div>

<div class="mb-3">
    <input type="date" id="filterDate" class="form-control d-inline w-auto">
    <input type="number" id="filterMinTotal" class="form-control d-inline w-auto" placeholder="–ú–∏–Ω. —Å—É–º–º–∞">
    <button class="btn btn-warning" onclick="getFilteredOrders()">üîç –§–∏–ª—å—Ç—Ä –ø–æ –¥–∞—Ç–µ –∏ —Å—É–º–º–µ</button>
</div>

<div class="mb-3">
    <input type="text" id="filterProductName" class="form-control d-inline w-auto" placeholder="–ò–º—è —Ç–æ–≤–∞—Ä–∞">
    <input type="date" id="filterStartDate" class="form-control d-inline w-auto">
    <input type="date" id="filterEndDate" class="form-control d-inline w-auto">
    <button class="btn btn-info" onclick="getOrdersWithoutProductAndInPeriod()">üîç –§–∏–ª—å—Ç—Ä –ø–æ —Ç–æ–≤–∞—Ä—É –∏ –ø–µ—Ä–∏–æ–¥—É</button>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞ -->
<div class="modal fade" id="createOrderModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">–°–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <input type="text" id="customerName" class="form-control mb-2" placeholder="–ò–º—è –∫–ª–∏–µ–Ω—Ç–∞">
                <input type="text" id="deliveryAddress" class="form-control mb-2" placeholder="–ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏">
                <input type="text" id="paymentType" class="form-control mb-2" placeholder="–¢–∏–ø –æ–ø–ª–∞—Ç—ã">
                <input type="text" id="deliveryType" class="form-control mb-2" placeholder="–¢–∏–ø –¥–æ—Å—Ç–∞–≤–∫–∏">
                <input type="number" id="totalAmount" class="form-control mb-2" placeholder="–û–±—â–∞—è —Å—É–º–º–∞">
                <h6>–î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä</h6>
                <input type="text" id="productSku" class="form-control mb-2" placeholder="–ê—Ä—Ç–∏–∫—É–ª —Ç–æ–≤–∞—Ä–∞">
                <input type="text" id="productName" class="form-control mb-2" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞">
                <input type="number" id="quantity" class="form-control mb-2" placeholder="–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ">
                <input type="number" id="price" class="form-control mb-2" placeholder="–¶–µ–Ω–∞">
                <button class="btn btn-secondary" onclick="addItem()">–î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä</button>
                <ul id="itemsList" class="mt-2"></ul>
            </div>
            <div class="modal-footer">
                <button class="btn btn-success" onclick="createOrder()">–°–æ–∑–¥–∞—Ç—å</button>
            </div>
        </div>
    </div>
</div>

<script>
    const apiBase = "/orders";
    let items = [];

    async function getAllOrders() {
        const response = await fetch(apiBase);
        const orders = await response.json();
        alert(JSON.stringify(orders, null, 2));
    }

    async function getOrderById() {
        const id = document.getElementById("orderId").value;
        const response = await fetch(`${apiBase}/${id ? id : ''}`);
        const order = await response.json();
        alert(JSON.stringify(order, null, 2));
    }

    async function getFilteredOrders() {
        const date = document.getElementById("filterDate").value;
        const minTotal = document.getElementById("filterMinTotal").value;
        const response = await fetch(`${apiBase}/filter?date=${date}&minTotal=${minTotal}`);
        const orders = await response.json();
        alert(JSON.stringify(orders, null, 2));
    }

    async function getOrdersWithoutProductAndInPeriod() {
        const productName = document.getElementById("filterProductName").value;
        const startDate = document.getElementById("filterStartDate").value;
        const endDate = document.getElementById("filterEndDate").value;
        const response = await fetch(`${apiBase}/filter-without-product?productName=${productName}&startDate=${startDate}&endDate=${endDate}`);
        const orders = await response.json();
        alert(JSON.stringify(orders, null, 2));
    }

    function addItem() {
        const sku = document.getElementById("productSku").value;
        const name = document.getElementById("productName").value;
        const quantity = document.getElementById("quantity").value;
        const price = document.getElementById("price").value;
        items.push({ productSku: sku, productName: name, quantity: parseInt(quantity), price: parseFloat(price) });
        document.getElementById("itemsList").innerHTML += `<li>${name} (${quantity} —à—Ç. –ø–æ ${price} —Ä—É–±.)</li>`;
    }

    async function createOrder() {
        const order = {
            orderNumber: "AUTO",
            customerName: document.getElementById("customerName").value,
            deliveryAddress: document.getElementById("deliveryAddress").value,
            paymentType: document.getElementById("paymentType").value,
            deliveryType: document.getElementById("deliveryType").value,
            totalAmount: parseFloat(document.getElementById("totalAmount").value),
            items: items
        };
        const response = await fetch(apiBase, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(order)
        });
        const result = await response.text();
        alert(result);
        items = [];
        document.getElementById("itemsList").innerHTML = "";
    }
</script>
</body>
</html>
